<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>10. 文本文件处理</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.021324d1.css" as="style"><link rel="preload" href="/assets/js/app.10b0d601.js" as="script"><link rel="preload" href="/assets/js/2.2959cc1c.js" as="script"><link rel="preload" href="/assets/js/6.015f8eaa.js" as="script"><link rel="prefetch" href="/assets/js/10.9cbbc5c7.js"><link rel="prefetch" href="/assets/js/11.698025f3.js"><link rel="prefetch" href="/assets/js/12.f5b7035e.js"><link rel="prefetch" href="/assets/js/13.9d4fea56.js"><link rel="prefetch" href="/assets/js/14.20b73f37.js"><link rel="prefetch" href="/assets/js/15.f45ceac0.js"><link rel="prefetch" href="/assets/js/16.dbad7df2.js"><link rel="prefetch" href="/assets/js/17.579cf571.js"><link rel="prefetch" href="/assets/js/18.41fd52b4.js"><link rel="prefetch" href="/assets/js/3.fcf23d77.js"><link rel="prefetch" href="/assets/js/4.fb4f81e2.js"><link rel="prefetch" href="/assets/js/5.05ba125a.js"><link rel="prefetch" href="/assets/js/7.023872ca.js"><link rel="prefetch" href="/assets/js/8.dfec0f28.js"><link rel="prefetch" href="/assets/js/9.ca0a9da6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.021324d1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_10-文本文件处理"><a href="#_10-文本文件处理" class="header-anchor">#</a> 10. 文本文件处理</h1> <h2 id="_10-1-字符串处理"><a href="#_10-1-字符串处理" class="header-anchor">#</a> 10.1 字符串处理</h2> <p>字符串在开发中经常用到，包括用户的输入，数据库读取的数据等，我们经常需要对字符串进行分割、连接、转换等操作，我们可以通过 Go 标准库中的 strings 和 strconv 两个包中的函数进行相应的操作。</p> <h3 id="_10-1-1-字符串操作"><a href="#_10-1-1-字符串操作" class="header-anchor">#</a> 10.1.1 字符串操作</h3> <p>下面这些函数来自于 strings 包，这里介绍一些我平常经常用到的函数，更详细的请参考官方的文档。</p> <h4 id="_10-1-1-1-contains"><a href="#_10-1-1-1-contains" class="header-anchor">#</a> 10.1.1.1 Contains</h4> <p>func Contains(s, substr string) bool
功能：字符串 s 中是否包含 substr，返回 bool 值</p> <p>示例代码：</p> <div class="language-Go extra-class"><pre class="language-go"><code>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;seafood&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;seafood&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;seafood&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//运行结果:</span>
    <span class="token comment">//true</span>
    <span class="token comment">//false</span>
    <span class="token comment">//true</span>
    <span class="token comment">//true</span>
</code></pre></div><h4 id="_10-1-1-2-join"><a href="#_10-1-1-2-join" class="header-anchor">#</a> 10.1.1.2 Join</h4> <p>func Join(a []string, sep string) string
功能：字符串链接，把 slice a 通过 sep 链接起来</p> <p>示例代码：
    s := []string{&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;}
    fmt.Println(strings.Join(s, &quot;, &quot;))
    //运行结果:foo, bar, baz</p> <h4 id="_10-1-1-3-index"><a href="#_10-1-1-3-index" class="header-anchor">#</a> 10.1.1.3 Index</h4> <p>func Index(s, sep string) int
功能：在字符串 s 中查找 sep 所在的位置，返回位置值，找不到返回-1</p> <p>示例代码：
    fmt.Println(strings.Index(&quot;chicken&quot;, &quot;ken&quot;))
    fmt.Println(strings.Index(&quot;chicken&quot;, &quot;dmr&quot;))
    //运行结果:
    //    4
    //    -1</p> <h4 id="_10-1-1-4-repeat"><a href="#_10-1-1-4-repeat" class="header-anchor">#</a> 10.1.1.4 Repeat</h4> <p>func Repeat(s string, count int) string
功能：重复 s 字符串 count 次，最后返回重复的字符串</p> <p>示例代码：
    fmt.Println(&quot;ba&quot; + strings.Repeat(&quot;na&quot;, 2))
    //运行结果:banana</p> <p>10.1.1.5 Replace
func Replace(s, old, new string, n int) string
功能：在 s 字符串中，把 old 字符串替换为 new 字符串，n 表示替换的次数，小于 0 表示全部替换</p> <p>示例代码：
    fmt.Println(strings.Replace(&quot;oink oink oink&quot;, &quot;k&quot;, &quot;ky&quot;, 2))
    fmt.Println(strings.Replace(&quot;oink oink oink&quot;, &quot;oink&quot;, &quot;moo&quot;, -1))
    //运行结果:
    //oinky oinky oink
    //moo moo moo</p> <h4 id="_10-1-1-6-split"><a href="#_10-1-1-6-split" class="header-anchor">#</a> 10.1.1.6 Split</h4> <p>func Split(s, sep string) []string
功能：把 s 字符串按照 sep 分割，返回 slice</p> <p>示例代码：</p> <div class="language-Go extra-class"><pre class="language-go"><code>    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">&quot;a,b,c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">&quot;a man a plan a canal panama&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">&quot; xyz &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bernardo O'Higgins&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//运行结果:</span>
    <span class="token comment">//[&quot;a&quot; &quot;b&quot; &quot;c&quot;]</span>
    <span class="token comment">//[&quot;&quot; &quot;man &quot; &quot;plan &quot; &quot;canal panama&quot;]</span>
    <span class="token comment">//[&quot; &quot; &quot;x&quot; &quot;y&quot; &quot;z&quot; &quot; &quot;]</span>
    <span class="token comment">//[&quot;&quot;]</span>
</code></pre></div><h4 id="_10-1-1-7-trim"><a href="#_10-1-1-7-trim" class="header-anchor">#</a> 10.1.1.7 Trim</h4> <p>func Trim(s string, cutset string) string
功能：在 s 字符串的头部和尾部去除 cutset 指定的字符串</p> <p>示例代码：
    fmt.Printf(&quot;[%q]&quot;, strings.Trim(&quot; !!! Achtung !!! &quot;, &quot;! &quot;))
    //运行结果:[&quot;Achtung&quot;]</p> <h4 id="_10-1-1-8-fields"><a href="#_10-1-1-8-fields" class="header-anchor">#</a> 10.1.1.8 Fields</h4> <p>func Fields(s string) []string
功能：去除 s 字符串的空格符，并且按照空格分割返回 slice</p> <p>示例代码：
    fmt.Printf(&quot;Fields are: %q&quot;, strings.Fields(&quot; foo bar baz &quot;))
    //运行结果:Fields are: [&quot;foo&quot; &quot;bar&quot; &quot;baz&quot;]</p> <h3 id="_10-1-2-字符串转换"><a href="#_10-1-2-字符串转换" class="header-anchor">#</a> 10.1.2 字符串转换</h3> <p>字符串转化的函数在 strconv 中，如下也只是列出一些常用的。</p> <h4 id="_10-1-2-1-append"><a href="#_10-1-2-1-append" class="header-anchor">#</a> 10.1.2.1 Append</h4> <p>Append 系列函数将整数等转换为字符串后，添加到现有的字节数组中。</p> <p>示例代码：</p> <div class="language-Go extra-class"><pre class="language-go"><code>    str <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
    str <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">AppendInt</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token number">4567</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">//以10进制方式追加</span>
    str <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">AppendBool</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    str <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">AppendQuote</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">&quot;abcdefg&quot;</span><span class="token punctuation">)</span>
    str <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">AppendQuoteRune</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">'单'</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//4567false&quot;abcdefg&quot;'单'</span>
</code></pre></div><h4 id="_10-1-2-2-format"><a href="#_10-1-2-2-format" class="header-anchor">#</a> 10.1.2.2 Format</h4> <p>Format 系列函数把其他类型的转换为字符串。</p> <p>示例代码：</p> <div class="language-Go extra-class"><pre class="language-go"><code>    a <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">FormatBool</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    b <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">FormatInt</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    c <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">FormatUint</span><span class="token punctuation">(</span><span class="token number">12345</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    d <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span><span class="token number">1023</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token comment">//false 1234 12345 1023</span>
</code></pre></div><h4 id="_10-1-2-3-parse"><a href="#_10-1-2-3-parse" class="header-anchor">#</a> 10.1.2.3 Parse</h4> <p>Parse 系列函数把字符串转换为其他类型。</p> <p>示例代码：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;strconv&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">checkError</span><span class="token punctuation">(</span>e <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> e <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseBool</span><span class="token punctuation">(</span><span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span>
    <span class="token function">checkError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    b<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseFloat</span><span class="token punctuation">(</span><span class="token string">&quot;123.23&quot;</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token function">checkError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    c<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseInt</span><span class="token punctuation">(</span><span class="token string">&quot;1234&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token function">checkError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    d<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseUint</span><span class="token punctuation">(</span><span class="token string">&quot;12345&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token function">checkError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    e<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span><span class="token string">&quot;1023&quot;</span><span class="token punctuation">)</span>
    <span class="token function">checkError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token comment">//false 123.23 1234 12345 1023</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_10-2-正则表达式"><a href="#_10-2-正则表达式" class="header-anchor">#</a> 10.2 正则表达式</h2> <p>正则表达式是一种进行模式匹配和文本操纵的复杂而又强大的工具。虽然正则表达式比纯粹的文本匹配效率低，但是它却更灵活。按照它的语法规则，随需构造出的匹配模式就能够从原始文本中筛选出几乎任何你想要得到的字符组合。</p> <p>Go 语言通过 regexp 标准包为正则表达式提供了官方支持，如果你已经使用过其他编程语言提供的正则相关功能，那么你应该对 Go 语言版本的不会太陌生，但是它们之间也有一些小的差异，因为 Go 实现的是 RE2 标准，除了\C，详细的语法描述参考：http://code.google.com/p/re2/wiki/Syntax</p> <p>其实字符串处理我们可以使用 strings 包来进行搜索(Contains、Index)、替换(Replace)和解析(Split、Join)等操作，但是这些都是简单的字符串操作，他们的搜索都是大小写敏感，而且固定的字符串，如果我们需要匹配可变的那种就没办法实现了，当然如果 strings 包能解决你的问题，那么就尽量使用它来解决。因为他们足够简单、而且性能和可读性都会比正则好。</p> <p>示例代码：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;regexp&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context1 <span class="token operator">:=</span> <span class="token string">&quot;3.14 123123 .68 haha 1.0 abc 6.66 123.&quot;</span>

    <span class="token comment">//MustCompile解析并返回一个正则表达式。如果成功返回，该Regexp就可用于匹配文本。</span>
    <span class="token comment">//解析失败时会产生panic</span>
    <span class="token comment">// \d 匹配数字[0-9]，d+ 重复&gt;=1次匹配d，越多越好（优先重复匹配d）</span>
    exp1 <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span><span class="token string">`\d+\.\d+`</span><span class="token punctuation">)</span>

    <span class="token comment">//返回保管正则表达式所有不重叠的匹配结果的[]string切片。如果没有匹配到，会返回nil。</span>
    <span class="token comment">//result1 := exp1.FindAllString(context1, -1) //[3.14 1.0 6.66]</span>
    result1 <span class="token operator">:=</span> exp1<span class="token punctuation">.</span><span class="token function">FindAllStringSubmatch</span><span class="token punctuation">(</span>context1<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//[[3.14] [1.0] [6.66]]</span>

    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> result1<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n------------------------------------\n\n&quot;</span><span class="token punctuation">)</span>

    context2 <span class="token operator">:=</span> <span class="token string">`
        &lt;title&gt;标题&lt;/title&gt;
        &lt;div&gt;你过来啊&lt;/div&gt;
        &lt;div&gt;hello mike&lt;/div&gt;
        &lt;div&gt;你大爷&lt;/div&gt;
        &lt;body&gt;呵呵&lt;/body&gt;
    `</span>
    <span class="token comment">//(.*?)被括起来的表达式作为分组</span>
    <span class="token comment">//匹配&lt;div&gt;xxx&lt;/div&gt;模式的所有子串</span>
    exp2 <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span><span class="token string">`&lt;div&gt;(.*?)&lt;/div&gt;`</span><span class="token punctuation">)</span>
    result2 <span class="token operator">:=</span> exp2<span class="token punctuation">.</span><span class="token function">FindAllStringSubmatch</span><span class="token punctuation">(</span>context2<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token comment">//[[&lt;div&gt;你过来啊&lt;/div&gt; 你过来啊] [&lt;div&gt;hello mike&lt;/div&gt; hello mike] [&lt;div&gt;你大爷&lt;/div&gt; 你大爷]]</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> result2<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n------------------------------------\n\n&quot;</span><span class="token punctuation">)</span>

    context3 <span class="token operator">:=</span> <span class="token string">`
        &lt;title&gt;标题&lt;/title&gt;
        &lt;div&gt;你过来啊&lt;/div&gt;
        &lt;div&gt;hello
        mike
        go&lt;/div&gt;
        &lt;div&gt;你大爷&lt;/div&gt;
        &lt;body&gt;呵呵&lt;/body&gt;
    `</span>
    exp3 <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span><span class="token string">`&lt;div&gt;(.*?)&lt;/div&gt;`</span><span class="token punctuation">)</span>
    result3 <span class="token operator">:=</span> exp3<span class="token punctuation">.</span><span class="token function">FindAllStringSubmatch</span><span class="token punctuation">(</span>context3<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token comment">//[[&lt;div&gt;你过来啊&lt;/div&gt; 你过来啊] [&lt;div&gt;你大爷&lt;/div&gt; 你大爷]]</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> result3<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n------------------------------------\n\n&quot;</span><span class="token punctuation">)</span>

    context4 <span class="token operator">:=</span> <span class="token string">`
        &lt;title&gt;标题&lt;/title&gt;
        &lt;div&gt;你过来啊&lt;/div&gt;
        &lt;div&gt;hello
        mike
        go&lt;/div&gt;
        &lt;div&gt;你大爷&lt;/div&gt;
        &lt;body&gt;呵呵&lt;/body&gt;
    `</span>
    exp4 <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span><span class="token string">`&lt;div&gt;(?s:(.*?))&lt;/div&gt;`</span><span class="token punctuation">)</span>
    result4 <span class="token operator">:=</span> exp4<span class="token punctuation">.</span><span class="token function">FindAllStringSubmatch</span><span class="token punctuation">(</span>context4<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token comment">/*
        [[&lt;div&gt;你过来啊&lt;/div&gt; 你过来啊] [&lt;div&gt;hello
            mike
            go&lt;/div&gt; hello
            mike
            go] [&lt;div&gt;你大爷&lt;/div&gt; 你大爷]]
    */</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> result4<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n------------------------------------\n\n&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> text <span class="token operator">:=</span> <span class="token keyword">range</span> result4 <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>text<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//带有div</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>text<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//不带带有div</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;================\n&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_10-3-json-处理"><a href="#_10-3-json-处理" class="header-anchor">#</a> 10.3 JSON 处理</h2> <p>JSON （JavaScript Object Notation）是一种比 XML 更轻量级的数据交换格式，在易于人们阅读和编写的同时，也易于程序解析和生成。尽管 JSON 是 JavaScript 的一个子集，但 JSON 采用完全独立于编程语言的文本格式，且表现为键/值对集合的文本描述形式（类似一些编程语言中的字典结构），这使它成为较为理想的、跨平台、跨语言的数据交换语言。</p> <p><img src="/assets/img/go64011.52d7955f.png" alt="123"></p> <p>开发者可以用 JSON 传输简单的字符串、数字、布尔值，也可以传输一个数组，或者一个更复杂的复合结构。在 Web 开发领域中， JSON 被广泛应用于 Web 服务端程序和客户端之间的数据通信。</p> <p>Go 语言内建对 JSON 的支持。使用 Go 语言内置的 encoding/json 标准库，开发者可以轻松使用 Go 程序生成和解析 JSON 格式的数据。</p> <p>JSON 官方网站：http://www.json.org/
在线格式化：http://www.json.cn/</p> <h3 id="_10-3-1-编码-json"><a href="#_10-3-1-编码-json" class="header-anchor">#</a> 10.3.1 编码 JSON</h3> <h4 id="_10-3-1-1-通过结构体生成-json"><a href="#_10-3-1-1-通过结构体生成-json" class="header-anchor">#</a> 10.3.1.1 通过结构体生成 JSON</h4> <p>使用 json.Marshal()函数可以对一组数据进行 JSON 格式的编码。 json.Marshal()函数的声明如下：
    func Marshal(v interface{}) ([]byte, error)</p> <p>还有一个格式化输出：
// MarshalIndent 很像 Marshal，只是用缩进对输出进行格式化
func MarshalIndent(v interface{}, prefix, indent string) ([]byte, error)</p> <ol><li>编码 JSON
示例代码：</li></ol> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;encoding/json&quot;</span>
    <span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> IT <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Company  <span class="token builtin">string</span>
    Subjects <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
    IsOk     <span class="token builtin">bool</span>
    Price    <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t1 <span class="token operator">:=</span> IT<span class="token punctuation">{</span><span class="token string">&quot;itcast&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Go&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C++&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Python&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Test&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">666.666</span><span class="token punctuation">}</span>

    <span class="token comment">//生成一段JSON格式的文本</span>
    <span class="token comment">//如果编码成功， err 将赋于零值 nil，变量b 将会是一个进行JSON格式化之后的[]byte类型</span>
    <span class="token comment">//b, err := json.Marshal(t1)</span>
    <span class="token comment">//输出结果：{&quot;Company&quot;:&quot;itcast&quot;,&quot;Subjects&quot;:[&quot;Go&quot;,&quot;C++&quot;,&quot;Python&quot;,&quot;Test&quot;],&quot;IsOk&quot;:true,&quot;Price&quot;:666.666}</span>

    b<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">MarshalIndent</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;    &quot;</span><span class="token punctuation">)</span>
    <span class="token comment">/*
        输出结果：
        {
            &quot;Company&quot;: &quot;itcast&quot;,
            &quot;Subjects&quot;: [
                &quot;Go&quot;,
                &quot;C++&quot;,
                &quot;Python&quot;,
                &quot;Test&quot;
            ],
            &quot;IsOk&quot;: true,
            &quot;Price&quot;: 666.666
        }
    */</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;json err:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>struct tag</li></ol> <p><img src="/assets/img/go65492.397cbfb5.png" alt="123"></p> <p>我们看到上面的输出字段名的首字母都是大写的，如果你想用小写的首字母怎么办呢？把结构体的字段名改成首字母小写的？JSON 输出的时候必须注意，只有导出的字段(首字母是大写)才会被输出，如果修改字段名，那么就会发现什么都不会输出，所以必须通过 struct tag 定义来实现。</p> <p>针对 JSON 的输出，我们在定义 struct tag 的时候需要注意的几点是：
 字段的 tag 是&quot;-&quot;，那么这个字段不会输出到 JSON
tag 中带有自定义名称，那么这个自定义名称会出现在 JSON 的字段名中
tag 中如果带有&quot;omitempty&quot;选项，那么如果该字段值为空，就不会输出到 JSON 串中
 如果字段类型是 bool, string, int, int64 等，而 tag 中带有&quot;,string&quot;选项，那么这个字段在输出到 JSON 的时候会把该字段对应的值转换成 JSON 字符串</p> <p>示例代码：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> IT <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">//Company不会导出到JSON中</span>
    Company <span class="token builtin">string</span> <span class="token string">`json:&quot;-&quot;`</span>

    <span class="token comment">// Subjects 的值会进行二次JSON编码</span>
    Subjects <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token string">`json:&quot;subjects&quot;`</span>

    <span class="token comment">//转换为字符串，再输出</span>
    IsOk <span class="token builtin">bool</span> <span class="token string">`json:&quot;,string&quot;`</span>

    <span class="token comment">// 如果 Price 为空，则不输出到JSON串中</span>
    Price <span class="token builtin">float64</span> <span class="token string">`json:&quot;price, omitempty&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t1 <span class="token operator">:=</span> IT<span class="token punctuation">{</span>Company<span class="token punctuation">:</span> <span class="token string">&quot;itcast&quot;</span><span class="token punctuation">,</span> Subjects<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Go&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C++&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Python&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Test&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> IsOk<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>

    b<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span>
    <span class="token comment">//json.MarshalIndent(t1, &quot;&quot;, &quot;    &quot;)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;json err:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//输出结果：{&quot;subjects&quot;:[&quot;Go&quot;,&quot;C++&quot;,&quot;Python&quot;,&quot;Test&quot;],&quot;IsOk&quot;:&quot;true&quot;,&quot;price&quot;:0}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_10-3-1-2-通过-map-生成-json"><a href="#_10-3-1-2-通过-map-生成-json" class="header-anchor">#</a> 10.3.1.2 通过 map 生成 JSON</h4> <div class="language-Go extra-class"><pre class="language-go"><code>    <span class="token comment">// 创建一个保存键值对的映射</span>
    t1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    t1<span class="token punctuation">[</span><span class="token string">&quot;company&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;itcast&quot;</span>
    t1<span class="token punctuation">[</span><span class="token string">&quot;subjects &quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Go&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C++&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Python&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Test&quot;</span><span class="token punctuation">}</span>
    t1<span class="token punctuation">[</span><span class="token string">&quot;isok&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
    t1<span class="token punctuation">[</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">666.666</span>

    b<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span>
    <span class="token comment">//json.MarshalIndent(t1, &quot;&quot;, &quot;    &quot;)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;json err:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//输出结果：{&quot;company&quot;:&quot;itcast&quot;,&quot;isok&quot;:true,&quot;price&quot;:666.666,&quot;subjects &quot;:[&quot;Go&quot;,&quot;C++&quot;,&quot;Python&quot;,&quot;Test&quot;]}</span>
</code></pre></div><h3 id="_10-3-2-解码-json"><a href="#_10-3-2-解码-json" class="header-anchor">#</a> 10.3.2 解码 JSON</h3> <p>可以使用 json.Unmarshal()函数将 JSON 格式的文本解码为 Go 里面预期的数据结构。</p> <p>json.Unmarshal()函数的原型如下：
    func Unmarshal(data []byte, v interface{}) error</p> <p>该函数的第一个参数是输入，即 JSON 格式的文本（比特序列），第二个参数表示目标输出容器，用于存放解码后的值。</p> <h4 id="_10-3-2-1-解析到结构体"><a href="#_10-3-2-1-解析到结构体" class="header-anchor">#</a> 10.3.2.1 解析到结构体</h4> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> IT <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Company  <span class="token builtin">string</span>   <span class="token string">`json:&quot;company&quot;`</span>
    Subjects <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token string">`json:&quot;subjects&quot;`</span>
    IsOk     <span class="token builtin">bool</span>     <span class="token string">`json:&quot;isok&quot;`</span>
    Price    <span class="token builtin">float64</span>  <span class="token string">`json:&quot;price&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    b <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">`{
    &quot;company&quot;: &quot;itcast&quot;,
    &quot;subjects&quot;: [
        &quot;Go&quot;,
        &quot;C++&quot;,
        &quot;Python&quot;,
        &quot;Test&quot;
    ],
    &quot;isok&quot;: true,
    &quot;price&quot;: 666.666
}`</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> t IT
    err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token operator">&amp;</span>t<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;json err:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
    <span class="token comment">//运行结果：{itcast [Go C++ Python Test] true 666.666}</span>

    <span class="token comment">//只想要Subjects字段</span>
    <span class="token keyword">type</span> IT2 <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        Subjects <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token string">`json:&quot;subjects&quot;`</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> t2 IT2
    err <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token operator">&amp;</span>t2<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;json err:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span>
    <span class="token comment">//运行结果：{[Go C++ Python Test]}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_10-3-2-2-解析到-interface"><a href="#_10-3-2-2-解析到-interface" class="header-anchor">#</a> 10.3.2.2 解析到 interface</h4> <p>示例代码：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    b <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">`{
    &quot;company&quot;: &quot;itcast&quot;,
    &quot;subjects&quot;: [
        &quot;Go&quot;,
        &quot;C++&quot;,
        &quot;Python&quot;,
        &quot;Test&quot;
    ],
    &quot;isok&quot;: true,
    &quot;price&quot;: 666.666
}`</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> t <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token operator">&amp;</span>t<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;json err:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>

    <span class="token comment">//使用断言判断类型</span>
    m <span class="token operator">:=</span> t<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> m <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> vv <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token builtin">string</span><span class="token punctuation">:</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">&quot;is string&quot;</span><span class="token punctuation">,</span> vv<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">&quot;is int&quot;</span><span class="token punctuation">,</span> vv<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token builtin">float64</span><span class="token punctuation">:</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">&quot;is float64&quot;</span><span class="token punctuation">,</span> vv<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">&quot;is bool&quot;</span><span class="token punctuation">,</span> vv<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">&quot;is an array:&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> i<span class="token punctuation">,</span> u <span class="token operator">:=</span> <span class="token keyword">range</span> vv <span class="token punctuation">{</span>
                fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> u<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">&quot;is of a type I don't know how to handle&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行结果：</p> <p><img src="/assets/img/go68985.1ab3e27f.png" alt="123"></p> <h2 id="_10-4-文件操作"><a href="#_10-4-文件操作" class="header-anchor">#</a> 10.4 文件操作</h2> <h3 id="_10-4-1-相关-api-介绍"><a href="#_10-4-1-相关-api-介绍" class="header-anchor">#</a> 10.4.1 相关 api 介绍</h3> <h4 id="_10-4-1-1-建立与打开文件"><a href="#_10-4-1-1-建立与打开文件" class="header-anchor">#</a> 10.4.1.1 建立与打开文件</h4> <p>新建文件可以通过如下两个方法：
func Create(name string) (file *File, err Error)
根据提供的文件名创建新的文件，返回一个文件对象，默认权限是 0666 的文件，返回的文件对象是可读写的。</p> <p>func NewFile(fd uintptr, name string) *File
根据文件描述符创建相应的文件，返回一个文件对象</p> <p>通过如下两个方法来打开文件：
func Open(name string) (file *File, err Error)
该方法打开一个名称为 name 的文件，但是是只读方式，内部实现其实调用了 OpenFile。</p> <p>func OpenFile(name string, flag int, perm uint32) (file *File, err Error)
打开名称为 name 的文件，flag 是打开的方式，只读、读写等，perm 是权限</p> <h4 id="_10-4-1-2-写文件"><a href="#_10-4-1-2-写文件" class="header-anchor">#</a> 10.4.1.2 写文件</h4> <p>func (file *File) Write(b []byte) (n int, err Error)
写入 byte 类型的信息到文件</p> <p>func (file *File) WriteAt(b []byte, off int64) (n int, err Error)
在指定位置开始写入 byte 类型的信息</p> <p>func (file *File) WriteString(s string) (ret int, err Error)
写入 string 信息到文件</p> <h4 id="_10-4-1-3-读文件"><a href="#_10-4-1-3-读文件" class="header-anchor">#</a> 10.4.1.3 读文件</h4> <p>func (file *File) Read(b []byte) (n int, err Error)
读取数据到 b 中</p> <p>func (file *File) ReadAt(b []byte, off int64) (n int, err Error)
从 off 开始读取数据到 b 中</p> <h4 id="_10-4-1-4-删除文件"><a href="#_10-4-1-4-删除文件" class="header-anchor">#</a> 10.4.1.4 删除文件</h4> <p>func Remove(name string) Error
调用该函数就可以删除文件名为 name 的文件</p> <h3 id="_10-4-2-示例代码"><a href="#_10-4-2-示例代码" class="header-anchor">#</a> 10.4.2 示例代码</h3> <h4 id="_10-4-2-1-写文件"><a href="#_10-4-2-1-写文件" class="header-anchor">#</a> 10.4.2.1 写文件</h4> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fout<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">&quot;./xxx.txt&quot;</span><span class="token punctuation">)</span> <span class="token comment">//新建文件</span>
    <span class="token comment">//fout, err := os.OpenFile(&quot;./xxx.txt&quot;, os.O_CREATE, 0666)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">defer</span> fout<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//main函数结束前， 关闭文件</span>

    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        outstr <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s:%d\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello go&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        fout<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>outstr<span class="token punctuation">)</span>     <span class="token comment">//写入string信息到文件</span>
        fout<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;abcd\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//写入byte类型的信息到文件</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>xxx.txt 内容如下：</p> <p><img src="/assets/img/go70421.f67c5d09.png" alt="123"></p> <h4 id="_10-4-2-2-读文件"><a href="#_10-4-2-2-读文件" class="header-anchor">#</a> 10.4.2.2 读文件</h4> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fin<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;./xxx.txt&quot;</span><span class="token punctuation">)</span> <span class="token comment">//打开文件</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">defer</span> fin<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token comment">//开辟1024个字节的slice作为缓冲</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        n<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> fin<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token comment">//读文件</span>
        <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>           <span class="token comment">//0表示已经到文件结束</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//输出读取的内容</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_10-4-3-案例：拷贝文件"><a href="#_10-4-3-案例：拷贝文件" class="header-anchor">#</a> 10.4.3 案例：拷贝文件</h3> <p>示例代码：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;io&quot;</span>
    <span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    args <span class="token operator">:=</span> os<span class="token punctuation">.</span>Args <span class="token comment">//获取用户输入的所有参数</span>

    <span class="token comment">//如果用户没有输入,或参数个数不够,则调用该函数提示用户</span>
    <span class="token keyword">if</span> args <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> <span class="token function">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;useage : xxx srcFile dstFile&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    srcPath <span class="token operator">:=</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">//获取输入的第一个参数</span>
    dstPath <span class="token operator">:=</span> args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment">//获取输入的第二个参数</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;srcPath = %s, dstPath = %s\n&quot;</span><span class="token punctuation">,</span> srcPath<span class="token punctuation">,</span> dstPath<span class="token punctuation">)</span>

    <span class="token keyword">if</span> srcPath <span class="token operator">==</span> dstPath <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;源文件和目的文件名字不能相同&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    srcFile<span class="token punctuation">,</span> err1 <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>srcPath<span class="token punctuation">)</span> <span class="token comment">//打开源文件</span>
    <span class="token keyword">if</span> err1 <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err1<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    dstFile<span class="token punctuation">,</span> err2 <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>dstPath<span class="token punctuation">)</span> <span class="token comment">//创建目的文件</span>
    <span class="token keyword">if</span> err2 <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err2<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token comment">//切片缓冲区</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        <span class="token comment">//从源文件读取内容，n为读取文件内容的长度</span>
        n<span class="token punctuation">,</span> err <span class="token operator">:=</span> srcFile<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> err <span class="token operator">!=</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;文件处理完毕&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//切片截取</span>
        tmp <span class="token operator">:=</span> buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span>
        <span class="token comment">//把读取的内容写入到目的文件</span>
        dstFile<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//关闭文件</span>
    srcFile<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    dstFile<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行结果：</p> <p><img src="/assets/img/go71974.252dadad.png" alt="123"></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.10b0d601.js" defer></script><script src="/assets/js/2.2959cc1c.js" defer></script><script src="/assets/js/6.015f8eaa.js" defer></script>
  </body>
</html>
